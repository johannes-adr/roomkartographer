var app=function(){"use strict";var t="undefined"!=typeof document?document.currentScript:null;function n(){}function e(t){return t()}function r(){return Object.create(null)}function o(t){t.forEach(e)}function i(t){return"function"==typeof t}function s(t,n){return t!=t?n==n:t!==n||t&&"object"==typeof t||"function"==typeof t}function a(t,e,r){t.$$.on_destroy.push(function(t,...e){if(null==t)return n;const r=t.subscribe(...e);return r.unsubscribe?()=>r.unsubscribe():r}(e,r))}function c(t,n){t.appendChild(n)}function u(t,n,e){t.insertBefore(n,e||null)}function l(t){t.parentNode&&t.parentNode.removeChild(t)}function f(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function h(){return d(" ")}function _(t,n,e,r){return t.addEventListener(n,e,r),()=>t.removeEventListener(n,e,r)}function g(t,n,e){null==e?t.removeAttribute(n):t.getAttribute(n)!==e&&t.setAttribute(n,e)}let w;function m(t){w=t}function b(t){(function(){if(!w)throw new Error("Function called outside component initialization");return w})().$$.on_mount.push(t)}const p=[],y=[];let $=[];const v=[],x=Promise.resolve();let S=!1;function E(t){$.push(t)}const M=new Set;let k=0;function R(){if(0!==k)return;const t=w;do{try{for(;k<p.length;){const t=p[k];k++,m(t),L(t.$$)}}catch(t){throw p.length=0,k=0,t}for(m(null),p.length=0,k=0;y.length;)y.pop()();for(let t=0;t<$.length;t+=1){const n=$[t];M.has(n)||(M.add(n),n())}$.length=0}while(p.length);for(;v.length;)v.pop()();S=!1,M.clear(),m(t)}function L(t){if(null!==t.fragment){t.update(),o(t.before_update);const n=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,n),t.after_update.forEach(E)}}const j=new Set;let A,W;function I(t,n){t&&t.i&&(j.delete(t),t.i(n))}function O(t,n,e,r){if(t&&t.o){if(j.has(t))return;j.add(t),A.c.push((()=>{j.delete(t),r&&(e&&t.d(1),r())})),t.o(n)}else r&&r()}function z(t,n,r,s){const{fragment:a,after_update:c}=t.$$;a&&a.m(n,r),s||E((()=>{const n=t.$$.on_mount.map(e).filter(i);t.$$.on_destroy?t.$$.on_destroy.push(...n):o(n),t.$$.on_mount=[]})),c.forEach(E)}function F(t,n){const e=t.$$;null!==e.fragment&&(!function(t){const n=[],e=[];$.forEach((r=>-1===t.indexOf(r)?n.push(r):e.push(r))),e.forEach((t=>t())),$=n}(e.after_update),o(e.on_destroy),e.fragment&&e.fragment.d(n),e.on_destroy=e.fragment=null,e.ctx=[])}function U(t,n){-1===t.$$.dirty[0]&&(p.push(t),S||(S=!0,x.then(R)),t.$$.dirty.fill(0)),t.$$.dirty[n/31|0]|=1<<n%31}function T(t,e,i,s,a,c,u,f=[-1]){const d=w;m(t);const h=t.$$={fragment:null,ctx:[],props:c,update:n,not_equal:a,bound:r(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:r(),dirty:f,skip_bound:!1,root:e.target||d.$$.root};u&&u(h.root);let _=!1;if(h.ctx=i?i(t,e.props||{},((n,e,...r)=>{const o=r.length?r[0]:e;return h.ctx&&a(h.ctx[n],h.ctx[n]=o)&&(!h.skip_bound&&h.bound[n]&&h.bound[n](o),_&&U(t,n)),e})):[],h.update(),_=!0,o(h.before_update),h.fragment=!!s&&s(h.ctx),e.target){if(e.hydrate){const t=function(t){return Array.from(t.childNodes)}(e.target);h.fragment&&h.fragment.l(t),t.forEach(l)}else h.fragment&&h.fragment.c();e.intro&&I(t.$$.fragment),z(t,e.target,e.anchor,e.customElement),R()}m(d)}class C{$destroy(){F(this,1),this.$destroy=n}$on(t,e){if(!i(e))return n;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(e),()=>{const t=r.indexOf(e);-1!==t&&r.splice(t,1)}}$set(t){var n;this.$$set&&(n=t,0!==Object.keys(n).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const N=new Array(128).fill(void 0);function P(t){return N[t]}N.push(void 0,null,!0,!1);let B=N.length;function D(t){const n=P(t);return function(t){t<132||(N[t]=B,B=t)}(t),n}let J=0,q=null;function Z(){return null!==q&&0!==q.byteLength||(q=new Uint8Array(W.memory.buffer)),q}const Y="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},G="function"==typeof Y.encodeInto?function(t,n){return Y.encodeInto(t,n)}:function(t,n){const e=Y.encode(t);return n.set(e),{read:t.length,written:e.length}};function H(t,n,e){if(void 0===e){const e=Y.encode(t),r=n(e.length)>>>0;return Z().subarray(r,r+e.length).set(e),J=e.length,r}let r=t.length,o=n(r)>>>0;const i=Z();let s=0;for(;s<r;s++){const n=t.charCodeAt(s);if(n>127)break;i[o+s]=n}if(s!==r){0!==s&&(t=t.slice(s)),o=e(o,r,r=s+3*t.length)>>>0;const n=Z().subarray(o+s,o+r);s+=G(t,n).written}return J=s,o}let K=null;function Q(){return null!==K&&0!==K.byteLength||(K=new Int32Array(W.memory.buffer)),K}const V="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};function X(t,n){return t>>>=0,V.decode(Z().subarray(t,t+n))}function tt(t){B===N.length&&N.push(N.length+1);const n=B;return B=N[n],N[n]=t,n}function nt(t){const n=typeof t;if("number"==n||"boolean"==n||null==t)return`${t}`;if("string"==n)return`"${t}"`;if("symbol"==n){const n=t.description;return null==n?"Symbol":`Symbol(${n})`}if("function"==n){const n=t.name;return"string"==typeof n&&n.length>0?`Function(${n})`:"Function"}if(Array.isArray(t)){const n=t.length;let e="[";n>0&&(e+=nt(t[0]));for(let r=1;r<n;r++)e+=", "+nt(t[r]);return e+="]",e}const e=/\[object ([^\]]+)\]/.exec(toString.call(t));let r;if(!(e.length>1))return toString.call(t);if(r=e[1],"Object"==r)try{return"Object("+JSON.stringify(t)+")"}catch(t){return"Object"}return t instanceof Error?`${t.name}: ${t.message}\n${t.stack}`:r}function et(t,n){try{return t.apply(this,n)}catch(t){W.__wbindgen_exn_store(tt(t))}}"undefined"!=typeof TextDecoder&&V.decode();class rt{static __wrap(t){t>>>=0;const n=Object.create(rt.prototype);return n.__wbg_ptr=t,n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,t}free(){const t=this.__destroy_into_raw();W.__wbg_smithjs_free(t)}constructor(t){const n=H(t,W.__wbindgen_malloc,W.__wbindgen_realloc),e=J,r=W.smithjs_new(n,e);return rt.__wrap(r)}serialize(t,n){try{const c=W.__wbindgen_add_to_stack_pointer(-16),u=H(n,W.__wbindgen_malloc,W.__wbindgen_realloc),l=J;W.smithjs_serialize(c,this.__wbg_ptr,tt(t),u,l);var e=Q()[c/4+0],r=Q()[c/4+1],o=Q()[c/4+2];if(Q()[c/4+3])throw D(o);var i=(s=e,a=r,s>>>=0,Z().subarray(s/1,s/1+a)).slice();return W.__wbindgen_free(e,1*r),i}finally{W.__wbindgen_add_to_stack_pointer(16)}var s,a}deserialize(t,n){try{const o=W.__wbindgen_add_to_stack_pointer(-16),i=function(t,n){const e=n(1*t.length)>>>0;return Z().set(t,e/1),J=t.length,e}(t,W.__wbindgen_malloc),s=J,a=H(n,W.__wbindgen_malloc,W.__wbindgen_realloc),c=J;W.smithjs_deserialize(o,this.__wbg_ptr,i,s,a,c);var e=Q()[o/4+0],r=Q()[o/4+1];if(Q()[o/4+2])throw D(r);return D(e)}finally{W.__wbindgen_add_to_stack_pointer(16)}}}function ot(){const t={wbg:{}};return t.wbg.__wbindgen_object_drop_ref=function(t){D(t)},t.wbg.__wbindgen_string_get=function(t,n){const e=P(n),r="string"==typeof e?e:void 0;var o=null==r?0:H(r,W.__wbindgen_malloc,W.__wbindgen_realloc),i=J;Q()[t/4+1]=i,Q()[t/4+0]=o},t.wbg.__wbindgen_string_new=function(t,n){return tt(X(t,n))},t.wbg.__wbg_parse_4457078060869f55=function(){return et((function(t,n){return tt(JSON.parse(X(t,n)))}),arguments)},t.wbg.__wbg_stringify_9003c389758d16d4=function(){return et((function(t){return tt(JSON.stringify(P(t)))}),arguments)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){return tt(new Error)},t.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const e=H(P(n).stack,W.__wbindgen_malloc,W.__wbindgen_realloc),r=J;Q()[t/4+1]=r,Q()[t/4+0]=e},t.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let e,r;try{e=t,r=n,console.error(X(t,n))}finally{W.__wbindgen_free(e,r)}},t.wbg.__wbindgen_debug_string=function(t,n){const e=H(nt(P(n)),W.__wbindgen_malloc,W.__wbindgen_realloc),r=J;Q()[t/4+1]=r,Q()[t/4+0]=e},t.wbg.__wbindgen_throw=function(t,n){throw new Error(X(t,n))},t}async function it(n){if(void 0!==W)return W;void 0===n&&(n=new URL("smith_js_bg.wasm",t&&t.src||new URL("bundle.js",document.baseURI).href));const e=ot();("string"==typeof n||"function"==typeof Request&&n instanceof Request||"function"==typeof URL&&n instanceof URL)&&(n=fetch(n));const{instance:r,module:o}=await async function(t,n){if("function"==typeof Response&&t instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(t,n)}catch(n){if("application/wasm"==t.headers.get("Content-Type"))throw n;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n)}const e=await t.arrayBuffer();return await WebAssembly.instantiate(e,n)}{const e=await WebAssembly.instantiate(t,n);return e instanceof WebAssembly.Instance?{instance:e,module:t}:e}}(await n,e);return function(t,n){return W=t.exports,it.__wbindgen_wasm_module=n,K=null,q=null,W.__wbindgen_start(),W}(r,o)}const st=[];class at{constructor(t,n){this.tag=t,this.val=n}static Forward(){return new at("Forward")}as_Forward(){if("Forward"!=this.tag)throw new Error("Enum WebMovement: trying to cast variant '"+this.tag+"' into 'Forward'")}static Stop(){return new at("Stop")}as_Stop(){if("Stop"!=this.tag)throw new Error("Enum WebMovement: trying to cast variant '"+this.tag+"' into 'Stop'")}static Left(){return new at("Left")}as_Left(){if("Left"!=this.tag)throw new Error("Enum WebMovement: trying to cast variant '"+this.tag+"' into 'Left'")}static Right(){return new at("Right")}as_Right(){if("Right"!=this.tag)throw new Error("Enum WebMovement: trying to cast variant '"+this.tag+"' into 'Right'")}static Speed(t){return new at("Speed",t)}as_Speed(){if("Speed"!=this.tag)throw new Error("Enum WebMovement: trying to cast variant '"+this.tag+"' into 'Speed'");return this.val}getTag(){return this.tag}}class ct{constructor(t,n){this.tag=t,this.val=n}static LidarScan(t){return new ct("LidarScan",t)}as_LidarScan(){if("LidarScan"!=this.tag)throw new Error("Enum WebPacket: trying to cast variant '"+this.tag+"' into 'LidarScan'");return this.val}static IMURotation(t){return new ct("IMURotation",t)}as_IMURotation(){if("IMURotation"!=this.tag)throw new Error("Enum WebPacket: trying to cast variant '"+this.tag+"' into 'IMURotation'");return this.val}static Movement(t){return new ct("Movement",t)}as_Movement(){if("Movement"!=this.tag)throw new Error("Enum WebPacket: trying to cast variant '"+this.tag+"' into 'Movement'");return this.val}getTag(){return this.tag}}let ut=[],lt=function(t,e=n){let r;const o=new Set;function i(n){if(s(t,n)&&(t=n,r)){const n=!st.length;for(const n of o)n[1](),st.push(n,t);if(n){for(let t=0;t<st.length;t+=2)st[t][0](st[t+1]);st.length=0}}}return{set:i,update:function(n){i(n(t))},subscribe:function(s,a=n){const c=[s,a];return o.add(c),1===o.size&&(r=e(i)||n),s(t),()=>{o.delete(c),0===o.size&&r&&(r(),r=null)}}}}(0),ft=0;class dt{constructor(t){this.zoomFactor=1,this.points=[],this.ctx=t.getContext("2d"),this.width=t.width,this.height=t.height,t.addEventListener("wheel",(t=>{this.zoomFactor+=1e-4*t.deltaY,this.zoomFactor<0&&(this.zoomFactor=0),this.render(this.points,0)})),this.setZoom(.2)}render(t,n){this.points=t,this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="blue";t.forEach((t=>{const n=this.transformCoordinate(t.x,"x"),e=this.transformCoordinate(t.y,"y");this.ctx.beginPath(),this.ctx.arc(n,e,1,0,2*Math.PI,!0),this.ctx.fill()})),this.ctx.fillText("zoom: "+Math.round(100*this.zoomFactor)/100,10,20),this.ctx.fillStyle="green",this.ctx.beginPath();let e=this.transformCoordinate(0,"x"),r=this.transformCoordinate(0,"y");this.ctx.arc(e,r,5,0,2*Math.PI,!0),this.ctx.fill()}transformCoordinate(t,n){const e=24*this.zoomFactor;return(t+e/2)/e*("x"===n?this.width:this.height)}setZoom(t){this.zoomFactor=t}}function ht(t){let e,r,i,s;return{c(){e=f("div"),r=h()},m(n,o){u(n,e,o),u(n,r,o),i||(s=[_(document.body,"keyup",t[4]),_(document.body,"keydown",t[5])],i=!0)},p:n,i:n,o:n,d(t){t&&l(e),t&&l(r),i=!1,o(s)}}}function _t(t,n,e){let{ws:r}=n,{smith:o}=n;function i(t){r.send(o.serialize(t,"WebPacket"))}let s="_";return t.$$set=t=>{"ws"in t&&e(2,r=t.ws),"smith"in t&&e(3,o=t.smith)},[s,i,r,o,()=>{e(0,s="_"),i(ct.Movement(at.Stop()))},t=>{let n=t.key;n!=s&&(e(0,s=n),"w"==n?i(ct.Movement(at.Forward())):"a"==n?i(ct.Movement(at.Left())):"s"==n?i(ct.Movement(at.Stop())):"d"==n&&i(ct.Movement(at.Right())))}]}class gt extends C{constructor(t){super(),T(this,t,_t,ht,s,{ws:2,smith:3})}}function wt(t){let n;return{c(){n=d("Start")},m(t,e){u(t,n,e)},d(t){t&&l(n)}}}function mt(t){let n;return{c(){n=d("Stop")},m(t,e){u(t,n,e)},d(t){t&&l(n)}}}function bt(t){let e;return{c(){e=d("Initing")},m(t,n){u(t,e,n)},p:n,i:n,o:n,d(t){t&&l(e)}}}function pt(t){let n,e;return n=new gt({props:{ws:t[0],smith:t[2]}}),{c(){var t;(t=n.$$.fragment)&&t.c()},m(t,r){z(n,t,r),e=!0},p(t,e){const r={};1&e&&(r.ws=t[0]),4&e&&(r.smith=t[2]),n.$set(r)},i(t){e||(I(n.$$.fragment,t),e=!0)},o(t){O(n.$$.fragment,t),e=!1},d(t){F(n,t)}}}function yt(t){let n,e,r,i,s,a,w,m,b,p,y,$,v,x,S,E,M;function k(t,n){return t[1]?mt:wt}let R=k(t),L=R(t);const j=[pt,bt],W=[];function z(t,n){return void 0!==t[0]&&null!==t[0]&&void 0!==t[2]?0:1}return $=z(t),v=W[$]=j[$](t),{c(){n=f("div"),e=f("button"),L.c(),r=d(" Recording"),i=h(),s=f("div"),a=f("div"),w=d("Rotation: "),m=d(t[5]),b=h(),p=f("canvas"),y=h(),v.c(),x=d(""),g(p,"width","400px"),g(p,"height","400px"),g(n,"id","root"),g(n,"class","svelte-1f2hcdn")},m(o,l){u(o,n,l),c(n,e),L.m(e,null),c(e,r),c(n,i),c(n,s),c(s,a),c(a,w),c(a,m),c(s,b),c(s,p),t[7](p),u(o,y,l),W[$].m(o,l),u(o,x,l),S=!0,E||(M=_(e,"click",t[6]),E=!0)},p(t,[n]){R!==(R=k(t))&&(L.d(1),L=R(t),L&&(L.c(),L.m(e,r))),(!S||32&n)&&function(t,n){n=""+n,t.data!==n&&(t.data=n)}(m,t[5]);let i=$;$=z(t),$===i?W[$].p(t,n):(A={r:0,c:[],p:A},O(W[i],1,1,(()=>{W[i]=null})),A.r||o(A.c),A=A.p,v=W[$],v?v.p(t,n):(v=W[$]=j[$](t),v.c()),I(v,1),v.m(x.parentNode,x))},i(t){S||(I(v),S=!0)},o(t){O(v),S=!1},d(e){e&&l(n),L.d(),t[7](null),e&&l(y),W[$].d(e),e&&l(x),E=!1,M()}}}function $t(t,n,e){let r,o;a(t,lt,(t=>e(5,r=t)));let i,s,c=!1,u=[];b((async()=>{await it("./pkg/smith_js_bg.wasm");let t=new dt(s);e(2,i=new rt(await(await fetch("/schema.smith")).text()));const n=`${location.protocol.startsWith("https")?"wss":"ws"}://${location.host}/ws`;let r=new WebSocket(n);r.readyState==r.CLOSED?e(0,o=null):(e(0,o=r),e(0,o.onmessage=async n=>{let e=await async function(t,n,e){let r=t.data;if(r instanceof Blob){let t=new Uint8Array(await r.arrayBuffer()),o=n.deserialize(t,"WebPacket");if(Object.setPrototypeOf(o,ct.prototype),"LidarScan"==o.getTag()){let t=o.as_LidarScan(),n=Number.parseInt(t.time);if(ut.length>0){let t=ut[0],e=Math.abs(t.time-n);for(let r=1;r<ut.length;r++){let o=ut[r],i=Math.abs(o.time-n);i<e&&(e=i,t=o)}ft=t.rotation}lt.set(ft),e(t.points,ft)}else if("IMURotation"==o.getTag()){let t=o.as_IMURotation();ut.push({rotation:t.rotation,time:Number.parseInt(t.time)}),ut.length>20&&(ut=[...ut.slice(1)])}return o}}(n,i,((n,e)=>{t.render(n,e)}));c&&u.push(e)},o))}));return[o,c,i,s,u,r,()=>{if(e(1,c=!c),c)return;let t=JSON.stringify(u);e(4,u=[]);const n=new Blob([t],{type:"text/json"}),r=window.document.createElement("a");r.href=window.URL.createObjectURL(n),r.download="SLAMData.json",document.body.appendChild(r),r.click(),document.body.removeChild(r)},function(t){y[t?"unshift":"push"]((()=>{s=t,e(3,s)}))}]}return new class extends C{constructor(t){super(),T(this,t,$t,yt,s,{})}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
